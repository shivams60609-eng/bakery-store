<!DOCTYPE html>
<html>
<head>
    <title>Admin Dashboard</title>
</head>
<body>

<h2>Admin Dashboard</h2>

<h3>Add Product</h3>

<form id="productForm" enctype="multipart/form-data">
    <input type="text" name="name" placeholder="Product Name" required><br><br>
    <input type="number" name="price" placeholder="Price" required><br><br>
    <input type="file" name="image" required><br><br>
    <button type="submit">Add Product</button>
</form>

<h3>Orders</h3>
<div id="orders"></div>

<script>
async function loadOrders(){
    const res = await fetch("/orders");
    if(res.status === 401){
        alert("Not authorized. Please login.");
        window.location.href="/login.html";
        return;
    }

    const orders = await res.json();
    const container = document.getElementById("orders");
    container.innerHTML="";

    orders.forEach(o=>{
        container.innerHTML+=`
        <div>
            <p><b>ID:</b> ${o.id}</p>
            <p><b>Status:</b> ${o.status}</p>
            <button onclick="updateOrder('${o.id}','Completed')">Mark Completed</button>
            <hr>
        </div>`;
    });
}

async function updateOrder(id,status){
    await fetch("/update-order/"+id,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({status})
    });
    loadOrders();
}

document.getElementById("productForm").addEventListener("submit", async (e)=>{
    e.preventDefault();
    const formData = new FormData(e.target);

    await fetch("/add-product",{
        method:"POST",
        body:formData
    });

    alert("Product Added!");
    e.target.reset();
});

loadOrders();
</script>

</body>
</html>